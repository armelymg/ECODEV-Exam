<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Exercice ECODEV - YAMEOGO B Armel</title>
    </head>
    <body>
        <p>TEST DE VITESSE DE FRAPPE</p>
        <h1>Mesurez votre vitesse de frappe</h1>
        <div class="container center-container">
            <div class="column1">
                <div id="time">
                    <div class="circle" style="--clr: #ffd000;">
                        <div class="dots"></div>
                        <svg>
                            <circle cx="40" cy="40" r="40"></circle>
                        </svg>
                        <div id="secondes" class="counter" style="font-weight: 800; font-size: 32px;">60 <br><span>secondes</span></div>
                    </div>
                </div>
            </div>
            <div class="column">
                <div id="mpm" class="counter">0</div>
                <div class="leg">
                    <p>mots/min</p>
                </div>
            </div>
            <div class="column">
                <div id="cpm" class="counter">0</div>
                <div class="leg">
                    <p>caractères/min</p>
                </div>
            </div>
            <div class="column">
                <div id="precision" class="counter">0</div>
                <div class="leg">
                    <p>%précision</p>
                </div>

            </div>
        </div>

        <p class="presentation">
            Le travail, notre ami. Ne soyez pas comme des chats : Friands de poissons, ils détestent la nage. Le travail est l'ami des vivants. Travaillez donc, travaillez!Les pauvres sont des charges pour l'humanité. Seriez-vous beau mais besogneux. Parlez, on ne vous écoute. En chemin, vous marchez derrière les autres Car l'enfant qui ne veut pas travailler. Dans un verger maraudeur;Dans la<br> ville, quémandeur;A la maison,de trop. Le travail,mes amis, Seul,fait l'homme.Flavien RANAIVO
        </p>

        <div class="center-container custom-textarea-container">
            <textarea id="text-area" class="custom-textarea" placeholder=""></textarea>
            <div id="placeholder" class="placeholder">
                Commencer à écrire
                <div class="triangle"></div>
            </div>
        </div>

        <div  class="performance">
            <h2 id="performance" style="color:red"></h2>
        </div>

    </body>

    <style>

        /* Définition de la police personnalisée */
        @font-face {
        font-family: 'MulaBold';
        src: url('./Mula-ExtraBlack.otf') format('otf');
        }

        body {
            background-color: rgb(238, 238, 239); /* couleur grise*/
            font-family: 'MulaBold', sans-serif;
            margin-left: 80px;
            margin-right: 80px;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px; /* Espace entre les colonnes */
            margin-bottom: 80px;
        }

        .performance {
            margin-top: 50px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .column {
            padding: 10px;
            margin: 10px;
            width: 60px;
            height: 60px;
            background-color: white;
            border-radius: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .column .leg{
            margin-top: 5px;
            display: flex;
            left: 50%;
            top: 50%;
        }

        .column .counter{
            margin-top: 10px;
            display: flex;
            left: 50%;
            top: 50%;
            font-weight: 800;
            font-size: 32px;

        }

        .column1 {
            margin-right: 60px;

        }

        .center-container {
            display: flex;
            justify-content: center;
            height: 10vh;
         }

        .center-container textarea {
            width: 61%;
        }

        #time {
            display: flex;
            gap: 30px;
        }

        #time .circle {
            position: relative;
            width: 100px;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #time .circle svg {
            position: relative;
            width: 100px;
            height: 100px;
            transform: rotate(270deg);
        }

        #time .circle svg circle {
            width: 100%;
            height: 100%;
            fill: white;
            stroke-width: 3;
            stroke: rgb(255, 208, 0);
            transform: translate(5px, 9px);
        }
        
        #time .circle svg circle:nth-child(2){
            stroke-dasharray: 440;
        }

        #time div {
            position: absolute;
            text-align: center;
            font-weight: 500;
            color: black;
            font-size: 1.5em;
        }

        #time div span {
            position: absolute;
            transform: translateX(-50%) translateY(-10px);
            font-size: 0.35em;
            font-weight: 300;
            letter-spacing: 0.1em;
        }

        #time .dots {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            z-index: 1000;
        }

        #time .dots::before{
            content: '';
            position: absolute;
            top: 10px;
            width: 10px;
            height: 10px;
            background: var(--clr);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--clr), 0 0 60px var(--clr);

        }

        P, H1, H4{
            text-align: center;
        }

        p {
            font-size: 14px;
        }

        h1 {
            font-size: 45px;
            font-weight: 900;
            margin-top: 0px;
        }

        .center-text {
          position: relative;
          left: 50%;
          top: 50%;

          transform: translate(-50%, -50%);
        }
    
        .center-text1 {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
        }

        .custom-textarea-container {
            position: relative;
            margin-top: 25px;
            width: 100%;
        }

        .custom-textarea {
            width: 100%;
            height: 100px;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            resize: none; /* Empêche la redimension du textarea */
            font-size: 16px; /* Taille de police du texte à l'intérieur du textarea */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Ombre */
        }

        .placeholder {
            position: absolute;
            padding: 7px;
            transform: translateY(-50%);
            background-color: rgb(255, 208, 0);
            border-radius: 7px;
        }

        .custom-textarea:focus + .placeholder {
            display: none; /* Masque le placeholder lorsque le textarea est en focus */
        }

        .presentation {
            margin-left: 270px;
            margin-right: 270px;
        }

        .triangle {
        position: absolute;
        margin-top: 5px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 7px solid transparent; /* Largeur du triangle */
        border-right: 7px solid transparent; /* Largeur du triangle */
        border-top: 8px solid rgb(255, 208, 0); /* Hauteur du triangle */
        }

    </style>

    <script>
        let countdown = document.getElementById("secondes");
        let sec_dot = document.querySelector(".dots");
        let textarea = document.getElementById('text-area');

        let mpm = document.getElementById('mpm'); // Nombre de mots par minutes
        let cpm = document.getElementById('cpm'); // Nombre de caractère par minutes
        let precision = document.getElementById('precision'); // Précision

        let performance = document.getElementById('performance');

        let nombreMots = 0;
        let nombreCaracteres = 0;

        let timer; // Stocke l'ID de la minuterie
        let seconds = 60; // Durée du compte à rebours (60 secondes)


        // Fonction pour démarrer le compte à rebours
        function startCountdown() {

            timer = setInterval(() => {
                seconds--;

                // Mise à jour du texte du compte à rebours
                countdown.innerHTML = `${seconds} <br><span>secondes</span>`;
                

                if (seconds <= 0) {
                    clearInterval(timer); // Arrête la minuterie lorsque le compte à rebours est terminé
                    countdown.innerHTML = `<p>Temps écoulé!</p>`;
                }
            }, 1000);
        }

        function updateCounters() {
            const text = textarea.value;

            // Comptage des mots
            const mots = text.trim().split(/\s+/); // Sépare les mots par espaces, sauts de ligne, etc.
            nombreMots = mots.length;

            // Comptage des caractères
            nombreCaracteres = text.length;

            // Mise à jour des éléments d'affichage
            mpm.innerText = nombreMots;
            cpm.innerText = nombreCaracteres;

            /* ------------------- */
            /* ------------------- */
            /* ------------------- */

            const userInput = textarea.value.trim(); // Texte saisi par l'utilisateur

            // Texte à saisir
            const givenText = "Le travail, notre ami. Ne soyez pas comme des chats : Friands de poissons, ils détestent la nage. Le travail est l'ami des vivants. Travaillez donc, travaillez!Les pauvres sont des charges pour l'humanité. Seriez-vous beau mais besogneux. Parlez, on ne vous écoute. En chemin, vous marchez derrière les autres Car l'enfant qui ne veut pas travailler. Dans un verger maraudeur;Dans la ville, quémandeur;A la maison,de trop. Le travail,mes amis, Seul,fait l'homme.Flavien RANAIVO";

            // Comparer les caractères correspondants
            let correctCount = 0;
            for (let i = 0; i < Math.max(userInput.length, givenText.length); i++) {
                if (userInput[i] === givenText[i]) {
                    correctCount++;
                }
            }

            // Calculer le pourcentage de précision
            const pourcentagePrecision = (correctCount / givenText.length) * 100;
            precision.innerText = `${pourcentagePrecision.toFixed(1)}`;

            timer = setTimeout(() => {
                textarea.disabled = true; // Désactiver le textarea
                performance.innerText = `Vous avez obtenu : ${calculNote(nombreMots, nombreCaracteres)}`;
            }, 60000);
        }

        // Écoutez l'événement de frappe dans le textarea
        textarea.addEventListener('keydown', () => {

            // Si le compte à rebours n'a pas encore été démarré, démarrez-le
            if (!timer) {
                startCountdown();
                placeholder.style.display = 'none'; // masquer le placeholder
            }
            if(seconds>0) { // On s'assure d'arreter les décomptes quand le temps imparti est écoulé
                updateCounters();
            }

        });

        function calculNote(mpm, cpm){
            if (mpm >= 120 || cpm >= 600) {
                return 'A';
            } else if (mpm >= 70 || cpm >= 350) {
                return 'B';
            } else if (mpm >= 60 || cpm >= 300) {
                return 'C';
            } else if (mpm >= 50 || cpm >= 250) {
                return 'D';
            } else if (mpm >= 40 || cpm >= 200) {
                return 'E';
            } else {
                return 'F';
            }
        }
    </script>


</html>
